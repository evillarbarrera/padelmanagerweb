<div class="admin-layout">
    <!-- Sidebar -->
    <!-- Sidebar -->
    <app-sidebar [userId]="userId" [jugadorNombre]="jugadorNombre" [jugadorFoto]="jugadorFoto" activePage="packs">
    </app-sidebar>

    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Top Header -->
        <header class="top-header">
            <div class="breadcrumbs">
                <span>Panel de Control</span>
                <span class="separator">/</span>
                <span class="current">Comprar Packs</span>
            </div>

            <div class="user-profile">
                <div class="user-info">
                    <span class="name">{{ jugadorNombre }}</span>
                    <span class="role">Jugador</span>
                </div>
                <div class="avatar-circle" *ngIf="!jugadorFoto">{{ jugadorNombre.charAt(0) }}</div>
                <img class="avatar-circle" *ngIf="jugadorFoto" [src]="jugadorFoto" style="object-fit: cover;">
            </div>
        </header>

        <!-- Content -->
        <div class="dashboard-grid">

            <div class="page-header">
                <h2 class="section-title">Packs Disponibles</h2>

                <!-- Filter Section -->
                <div class="controls-wrapper">
                    <!-- Location Filter -->
                    <div class="location-filter">
                        <button class="btn-location" [class.active]="useLocation" (click)="toggleLocation()">
                            <span *ngIf="!isLoadingLocation">{{ useLocation ? 'üìç Usando mi ubicaci√≥n' : 'üåç Filtar por
                                Cercan√≠a' }}</span>
                            <span *ngIf="isLoadingLocation" class="spinner-small"></span>
                        </button>

                        <div class="radius-control" *ngIf="useLocation">
                            <label>Radio: <strong>{{ searchRadius }} km</strong></label>
                            <input type="range" min="5" max="100" step="5" [value]="searchRadius"
                                (change)="onRadiusChange($event)">
                        </div>
                    </div>

                    <!-- Coach Filter -->
                    <div class="filter-dropdown">
                        <select id="coach-select" (change)="onEntrenadorChange($event)">
                            <option [value]="null" [selected]="selectedEntrenador === null">Todos los entrenadores
                            </option>
                            <option *ngFor="let entrenador of entrenadores" [value]="entrenador.id"
                                [selected]="selectedEntrenador === entrenador.id">
                                {{ entrenador.nombre }}
                            </option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="packs-grid" *ngIf="packsFiltrados.length > 0; else noPacks">
                <div class="pack-card" *ngFor="let pack of packsFiltrados">
                    <div class="pack-type" [ngClass]="pack.tipo">
                        <span *ngIf="pack.cantidad_personas > 1">PACK {{ pack.cantidad_personas }} JUGADORES</span>
                        <span *ngIf="!pack.cantidad_personas || pack.cantidad_personas <= 1">
                            {{ pack.tipo === 'individual' ? 'Individual' : 'Grupal' }}
                        </span>
                    </div>

                    <div class="pack-icon">
                        <span *ngIf="pack.clases > 10">üèÜ</span>
                        <span *ngIf="pack.clases <= 10 && pack.clases > 5">‚ö°</span>
                        <span *ngIf="pack.clases <= 5">üéæ</span>
                    </div>

                    <h2 class="pack-title">{{ pack.nombre }}</h2>
                    <p class="coach-name" style="color: #888; font-size: 0.9em; margin-bottom: 10px;">
                        Coach: {{ pack.entrenador_nombre }}
                    </p>

                    <div class="distance-badge" *ngIf="pack.distancia !== undefined && pack.distancia !== null">
                        üìç A {{ pack.distancia }} km
                    </div>

                    <div class="pack-price">
                        ${{ pack.precio | number:'1.0-0':'es' }}<span>/pack</span>
                    </div>

                    <ul class="pack-details">
                        <li><strong>{{ pack.sesiones_totales }}</strong> Clases inclu√≠das</li>
                        <li *ngIf="pack.cantidad_personas > 1"><strong>V√°lido para {{ pack.cantidad_personas }}
                                jugadores</strong></li>
                        <li *ngIf="!pack.cantidad_personas || pack.cantidad_personas <= 1">Uso personal (1 jugador)</li>
                        <li>
                            Horario: <strong>{{ pack.rango_horario_inicio ? (pack.rango_horario_inicio | slice:0:5) + '
                                a ' + (pack.rango_horario_fin | slice:0:5) : 'Sin restricci√≥n' }}</strong>
                        </li>
                        <li>Acceso a reservas online</li>
                    </ul>

                    <button class="btn-buy" (click)="comprarPack(pack)">
                        Comprar Ahora
                    </button>
                </div>
            </div>

            <ng-template #noPacks>
                <div class="no-packs">
                    <p>No hay packs disponibles en este momento.</p>
                </div>
            </ng-template>

        </div>
    </main>
</div>