<div class="admin-layout">
  <app-sidebar [userId]="userId" [jugadorNombre]="coachNombre" [jugadorFoto]="coachFoto" [role]="'entrenador'"
    activePage="agenda">
  </app-sidebar>

  <main class="main-content">


    <div class="dashboard-grid">
      <div class="hero-section">
        <h2
          style="font-size: 2rem; font-weight: 900; color: var(--text-main); letter-spacing: -1px; margin-bottom: 0.5rem;">
          Mi Agenda Semanal</h2>
        <p style="color: var(--text-secondary);">Tus sesiones programadas para los pr√≥ximos d√≠as</p>
      </div>

      <!-- Day Selector (Premium Tabs) -->
      <div class="segment-wrapper animate-up" *ngIf="dias.length > 0">
        <div class="nike-segment-days">
          <div *ngFor="let dia of dias" class="segment-button" [class.checked]="diaSeleccionado === dia.fecha"
            (click)="seleccionarDia(dia.fecha)">
            <span class="day-name">{{ dia.nombre | slice:0:3 }}</span>
            <span class="day-date">{{ dia.fecha | date:'dd' }}</span>
            <div *ngIf="dia.data.length > 0" class="dot-indicator"></div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoading && agendaActual.length === 0" class="empty-state animate-up">
        <div class="empty-icon">üì≠</div>
        <h3>Agenda Libre</h3>
        <p>No tienes clases programadas para este d√≠a.</p>
      </div>

      <!-- Agenda List (Standardized Cards) -->
      <div class="agenda-list" *ngIf="!isLoading && agendaActual.length > 0">

        <div class="session-card animate-up" *ngFor="let item of agendaActual; let i = index"
          [style.animation-delay]="(i * 0.05) + 's'" [ngClass]="{
            'pack-grupal': (item.tipo === 'grupal' || item.tipo === 'pack_grupal' || item.tipo === 'grupal_template'),
            'reserva-individual': (item.tipo !== 'grupal' && item.tipo !== 'pack_grupal' && item.tipo !== 'grupal_template'),
            'full-capacity': item.cupos_ocupados >= item.capacidad_maxima
          }">

          <div class="card-header">
            <div class="time-badge">
              <span class="icon">üïí</span>
              <ng-container
                *ngIf="item.tipo === 'grupal' || item.tipo === 'pack_grupal' || item.tipo === 'grupal_template'">
                <span>{{ item.hora_inicio | slice:0:5 }} - {{ item.hora_fin | slice:0:5 }}</span>
              </ng-container>
              <ng-container
                *ngIf="item.tipo !== 'grupal' && item.tipo !== 'pack_grupal' && item.tipo !== 'grupal_template'">
                <span>{{ item.hora_inicio | slice:0:5 }} - {{ item.hora_fin | slice:0:5 }}</span>
              </ng-container>
            </div>
            <div class="status-tag" [ngClass]="getEstadoText(item).toLowerCase()">
              {{ getEstadoText(item) }}
            </div>
          </div>

          <div class="card-body">
            <!-- INDIVIDUAL -->
            <div *ngIf="item.tipo !== 'grupal' && item.tipo !== 'pack_grupal' && item.tipo !== 'grupal_template'"
              class="players-list">
              <div *ngFor="let jugador of item.inscritos" class="player-profile">
                <div class="avatar-circle-small">
                  <img *ngIf="jugador.foto" [src]="jugador.foto"
                    style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                  <span *ngIf="!jugador.foto">üë§</span>
                </div>
                <div class="player-details">
                  <h3>{{ jugador.nombre }}</h3>
                  <p>{{ jugador.email }}</p>
                </div>
              </div>
            </div>

            <!-- GRUPAL Info -->
            <div *ngIf="item.tipo === 'grupal' || item.tipo === 'pack_grupal' || item.tipo === 'grupal_template'"
              class="grupal-info">
              <div class="grupal-header">
                <div class="tipo-badge">üë• GRUPAL</div>
                <span class="categoria">{{ item.categoria }}</span>
                <button class="wa-quick-btn" (click)="openWhatsAppGroup(item)" title="Contactar grupo">
                  <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WA" width="16">
                </button>
              </div>
              <div class="cupos-info">
                <span class="badge-cupos" [ngClass]="item.estado_grupo">
                  {{ item.cupos_ocupados }}/{{ item.capacidad_maxima }} cupos
                </span>
                <span class="duracion">‚è±Ô∏è {{ item.duracion_calculada || 0 }}min</span>
              </div>

              <!-- Lista de Inscritos (Nombres Completos) -->
              <div class="inscritos-list" *ngIf="item.inscritos && item.inscritos.length > 0">
                <p class="inscritos-title">Inscritos:</p>
                <div class="inscritos-container">
                  <div *ngFor="let inscrito of item.inscritos" class="inscrito-row">
                    <div class="avatar-mini">
                      <img *ngIf="inscrito.foto" [src]="inscrito.foto"
                        style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">
                      <span *ngIf="!inscrito.foto">üë§</span>
                    </div>
                    <div class="inscrito-detail">
                      <span class="full-name">{{ inscrito.nombre }}</span>
                      <span class="email-sub">{{ inscrito.email }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="pack-row" *ngIf="item.pack_nombre">
              <span class="pack-label">{{ item.pack_nombre }}</span>
            </div>
          </div>

          <div class="card-footer" *ngIf="(item.estado !== 'cancelado' && item.estado_grupo !== 'cancelado')">
            <button class="action-btn cancel" (click)="cancelarClase(item)">
              ‚úï Cancelar {{ item.tipo === 'grupal' ? 'Pack' : 'Clase' }}
            </button>
          </div>
        </div>

      </div>
    </div>
  </main>
</div>