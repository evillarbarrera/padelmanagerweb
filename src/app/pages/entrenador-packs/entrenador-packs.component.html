<div class="admin-layout">
  <app-sidebar [userId]="userId" [jugadorNombre]="coachNombre" [jugadorFoto]="coachFoto" [role]="'entrenador'"
    activePage="packs">
  </app-sidebar>

  <main class="main-content">


    <div class="dashboard-grid">
      <!-- Hero Section -->
      <div class="hero-section">
        <div class="hero-text">
          <h2>Mis Packs de Entrenamiento</h2>
          <p>Crea y gestiona tus paquetes de clases</p>
        </div>
        <button class="add-btn" (click)="toggleFormulario()">
          {{ mostrarFormulario ? '‚úï Cancelar' : '+ Crear Nuevo Pack' }}
        </button>
      </div>

      <!-- Search Bar -->
      <div class="search-section">
        <span class="search-icon">üîç</span>
        <input [(ngModel)]="filtro" type="text" placeholder="Buscar pack..." class="search-input" />
      </div>

      <!-- Create/Edit Form -->
      <div class="form-wrapper animate-down" *ngIf="mostrarFormulario">
        <div class="form-header">
          <h3>{{ nuevoPack.id ? 'Editar Pack' : 'Crear Nuevo Pack' }}</h3>
        </div>

        <form (ngSubmit)="crearPack()" class="pack-form">
          <div class="form-grid">
            <!-- Name -->
            <div class="form-group span-2">
              <label>Nombre del Pack</label>
              <input [(ngModel)]="nuevoPack.nombre" name="nombre" type="text" placeholder="Ej: Pack Principiantes"
                class="form-input" />
            </div>

            <!-- Type -->
            <div class="form-group">
              <label>Tipo</label>
              <select [(ngModel)]="nuevoPack.tipo" name="tipo" class="form-input">
                <option value="individual">Individual</option>
                <option value="grupal">Grupal</option>
              </select>
            </div>

            <!-- Sessions -->
            <div class="form-group">
              <label>Sesiones Totales</label>
              <input [(ngModel)]="nuevoPack.sesiones_totales" name="sesiones" type="number" placeholder="4"
                class="form-input" />
            </div>

            <!-- Group Specific Fields -->
            <ng-container *ngIf="nuevoPack.tipo === 'grupal'">
              <div class="form-group">
                <label>Capacidad M√≠nima</label>
                <input [(ngModel)]="nuevoPack.capacidad_minima" name="cap_min" type="number" min="2" max="6"
                  class="form-input" />
              </div>
              <div class="form-group">
                <label>Capacidad M√°xima</label>
                <input [(ngModel)]="nuevoPack.capacidad_maxima" name="cap_max" type="number" min="2" max="6"
                  class="form-input" />
              </div>

              <div class="form-group">
                <label>D√≠a de Clase</label>
                <select [(ngModel)]="nuevoPack.dia_semana" name="dia" class="form-input">
                  <option [ngValue]="1">Lunes</option>
                  <option [ngValue]="2">Martes</option>
                  <option [ngValue]="3">Mi√©rcoles</option>
                  <option [ngValue]="4">Jueves</option>
                  <option [ngValue]="5">Viernes</option>
                  <option [ngValue]="6">S√°bado</option>
                  <option [ngValue]="0">Domingo</option>
                </select>
              </div>

              <div class="form-group">
                <label>Hora Inicio</label>
                <input [(ngModel)]="nuevoPack.hora_inicio" name="hora" type="time" class="form-input" />
              </div>

              <div class="form-group span-2">
                <label>Categor√≠a</label>
                <input [(ngModel)]="nuevoPack.categoria" name="categoria" type="text"
                  placeholder="Ej: Intermedio, Avanzado" class="form-input" />
              </div>
            </ng-container>

            <!-- Duration -->
            <div class="form-group">
              <label>Duraci√≥n (min)</label>
              <input [(ngModel)]="nuevoPack.duracion_sesion_min" name="duracion" type="number" placeholder="60"
                class="form-input" />
            </div>

            <!-- Price -->
            <div class="form-group">
              <label>Precio ($)</label>
              <input [(ngModel)]="nuevoPack.precio" name="precio" type="number" placeholder="0" class="form-input" />
            </div>

            <!-- Description -->
            <!-- Time range (Valid Hours) -->
            <div class="form-group span-2" *ngIf="nuevoPack.tipo === 'individual'">
              <div class="flex-row gap-2" style="margin-bottom: 20px;">
                <div class="half-width">
                  <label>Cantidad Personas</label>
                  <p class="helper-text">Ej: 2 para Pack Dupla.</p>
                  <input [(ngModel)]="nuevoPack.cantidad_personas" name="cant_personas" type="number" min="1"
                    class="form-input" />
                </div>
              </div>

              <label>Rango Horario Permitido (Opcional)</label>
              <p class="helper-text">Si llenas esto, el alumno solo podr√° reservar clases dentro de este horario.</p>
              <div class="flex-row gap-2">
                <div class="half-width">
                  <label class="sub-label">Desde</label>
                  <input [(ngModel)]="nuevoPack.rango_horario_inicio" name="r_inicio" type="time" class="form-input" />
                </div>
                <div class="half-width">
                  <label class="sub-label">Hasta</label>
                  <input [(ngModel)]="nuevoPack.rango_horario_fin" name="r_fin" type="time" class="form-input" />
                </div>
              </div>
            </div>

            <div class="form-group span-full">
              <label>Descripci√≥n</label>
              <textarea [(ngModel)]="nuevoPack.descripcion" name="descripcion" placeholder="Detalles del pack..."
                class="form-textarea"></textarea>
            </div>
          </div>

          <button type="submit" class="btn-submit">
            {{ nuevoPack.id ? 'Guardar Cambios' : 'Crear Pack' }}
          </button>
        </form>
      </div>

      <!-- Loading State -->
      <div class="loading-state" *ngIf="isLoading">
        <div class="spinner"></div>
        <p>Cargando packs...</p>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoading && packsFiltrados.length === 0" class="empty-state">
        <div class="empty-icon">üì¶</div>
        <p>{{ filtro ? 'Sin resultados' : 'No tienes packs creados a√∫n.' }}</p>
      </div>

      <!-- Packs List -->
      <div class="packs-grid" *ngIf="!isLoading && packsFiltrados.length > 0">
        <div class="pack-card animate-up" *ngFor="let pack of packsFiltrados; let i = index"
          [style.animation-delay]="(i * 0.05) + 's'">

          <div class="pack-type" [ngClass]="pack.tipo">
            <span *ngIf="pack.cantidad_personas > 1">PACK {{ pack.cantidad_personas }} JUGADORES</span>
            <span *ngIf="!pack.cantidad_personas || pack.cantidad_personas <= 1">
              {{ pack.tipo === 'individual' ? 'Individual' : 'Grupal' }}
            </span>
          </div>

          <div class="pack-icon">
            <span *ngIf="pack.sesiones_totales > 10">üèÜ</span>
            <span *ngIf="pack.sesiones_totales <= 10 && pack.sesiones_totales > 5">‚ö°</span>
            <span *ngIf="pack.sesiones_totales <= 5">üéæ</span>
          </div>

          <h2 class="pack-title">{{ pack.nombre }}</h2>

          <div class="pack-price">
            ${{ pack.precio | number:'1.0-0':'es' }}<span>/pack</span>
          </div>

          <ul class="pack-details">
            <li><strong>{{ pack.sesiones_totales }}</strong> Clases inclu√≠das</li>
            <li *ngIf="pack.cantidad_personas > 1"><strong>V√°lido para {{ pack.cantidad_personas }} jugadores</strong>
            </li>
            <li *ngIf="!pack.cantidad_personas || pack.cantidad_personas <= 1">Uso personal (1 jugador)</li>
            <li>
              Horario: <strong>{{ pack.rango_horario_inicio ? (pack.rango_horario_inicio | slice:0:5) + ' a ' +
                (pack.rango_horario_fin | slice:0:5) : 'Sin restricci√≥n' }}</strong>
            </li>
            <li *ngIf="pack.tipo === 'grupal'">
              Cupos: <strong
                [ngClass]="{'full': pack.cupos_ocupados >= pack.capacidad_maxima, 'open': pack.cupos_ocupados < pack.capacidad_maxima}">
                {{ pack.cupos_ocupados || 0 }} / {{ pack.capacidad_maxima }}
              </strong>
            </li>
          </ul>

          <div class="pack-footer">
            <button class="action-btn edit" (click)="editarPack(pack)">Editar</button>
            <button class="action-btn delete" (click)="eliminarPack(pack.id)">Eliminar</button>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>