<div class="admin-layout">
    <app-sidebar [userId]="userId" [jugadorNombre]="userName" [jugadorFoto]="userFoto" [role]="userRole"
        activePage="americanos">
    </app-sidebar>

    <main class="main-content">

        <div class="dashboard-container">
            <div class="header-main">
                <h1>Gesti√≥n de Torneos</h1>
                <p>Crea y administra tus torneos americanos.</p>
            </div>

            <!-- TAB NAVIGATION -->
            <div class="main-tabs-nav">
                <button class="tab-btn" [class.active]="activeTab === 'list'" (click)="activeTab = 'list'">
                    <span class="icon">üèÜ</span> Ver Mis Torneos
                </button>
                <button class="tab-btn" [class.active]="activeTab === 'create'" (click)="activeTab = 'create'">
                    <span class="icon">‚ûï</span> Crear Nuevo Torneo
                </button>
                <button class="tab-btn" [class.active]="activeTab === 'history'" (click)="activeTab = 'history'">
                    <span class="icon">üìú</span> Historial
                </button>
            </div>

            <div class="main-grid">
                <!-- VISTA: CREAR TORNEO -->
                <div class="view-container" *ngIf="activeTab === 'create'">
                    <div class="card glass-card">
                        <div class="card-header">
                            <h2>Configurar Nuevo Torneo Americano</h2>
                        </div>
                        <div class="form-section full-width">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label><span class="label-icon">üè¢</span> Club</label>
                                    <select [(ngModel)]="torneo.club_id">
                                        <option *ngFor="let c of clubes" [value]="c.id">{{ c.nombre }}</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label><span class="label-icon">üìù</span> Nombre del Torneo</label>
                                    <input type="text" [(ngModel)]="torneo.nombre"
                                        placeholder="Ej: Americano Verano 2026">
                                </div>
                                <div class="form-group">
                                    <label><span class="label-icon">üìÖ</span> Fecha</label>
                                    <input type="date" [(ngModel)]="torneo.fecha">
                                </div>
                                <div class="form-group">
                                    <label><span class="label-icon">‚è∞</span> Hora Inicio</label>
                                    <input type="time" [(ngModel)]="torneo.hora_inicio">
                                </div>
                                <div class="form-group">
                                    <label><span class="label-icon">üèÜ</span> Tipo de Torneo</label>
                                    <select [(ngModel)]="torneo.tipo_torneo">
                                        <option value="estandar">Americano Est√°ndar (Todos contra todos)</option>
                                        <option value="grupos">Americano Mini Torneo (8 Parejas + Semis)</option>
                                    </select>
                                    <small class="form-hint" *ngIf="torneo.tipo_torneo === 'grupos'">Ideal para 8
                                        parejas con llaves finales.</small>
                                </div>
                                <div class="form-group">
                                    <label><span class="label-icon">üè∑Ô∏è</span> Modalidad de Inscripci√≥n</label>
                                    <select [(ngModel)]="torneo.modalidad">
                                        <option value="unicategoria">Categor√≠a √önica</option>
                                        <option value="suma">Suma "X" (Nivel Pareja)</option>
                                        <option value="mixto">Mixtos (Hombre/Mujer)</option>
                                    </select>
                                </div>
                                <div class="form-group animate-in" *ngIf="torneo.modalidad === 'suma'">
                                    <label><span class="label-icon">‚ûï</span> Valor de Suma</label>
                                    <input type="number" [(ngModel)]="torneo.valor_suma" placeholder="Ej: 9">
                                </div>
                                <div class="form-group animate-in" *ngIf="torneo.modalidad !== 'mixto'">
                                    <label><span class="label-icon">üöª</span> G√©nero</label>
                                    <select [(ngModel)]="torneo.genero">
                                        <option value="Varones">Varones</option>
                                        <option value="Damas">Damas</option>
                                    </select>
                                </div>
                                <div class="form-group animate-in" *ngIf="torneo.modalidad === 'unicategoria'">
                                    <label><span class="label-icon">üìä</span> Categor√≠a</label>
                                    <select [(ngModel)]="torneo.categoria">
                                        <optgroup label="Open / Masculino" *ngIf="torneo.genero === 'Varones'">
                                            <option value="Primera">Primera</option>
                                            <option value="Segunda">Segunda</option>
                                            <option value="Tercera">Tercera</option>
                                            <option value="Cuarta">Cuarta</option>
                                            <option value="Quinta">Quinta</option>
                                            <option value="Sexta">Sexta</option>
                                        </optgroup>
                                        <optgroup label="Damas" *ngIf="torneo.genero === 'Damas'">
                                            <option value="Primera Damas">1¬™ Damas</option>
                                            <option value="Segunda Damas">2¬™ Damas</option>
                                            <option value="Tercera Damas">3¬™ Damas</option>
                                            <option value="Cuarta Damas">4¬™ Damas</option>
                                            <option value="Quinta Damas">5¬™ Damas</option>
                                            <option value="Sexta Damas">6¬™ Damas</option>
                                        </optgroup>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label><span class="label-icon">üéæ</span> Cantidad de Canchas</label>
                                    <input type="number" [(ngModel)]="torneo.num_canchas" min="1" max="10">
                                </div>
                                <div class="form-group">
                                    <label><span class="label-icon">üë•</span> M√°ximo de Parejas</label>
                                    <input type="number" [(ngModel)]="torneo.max_parejas" placeholder="Ej: 8">
                                </div>
                                <div class="form-group">
                                    <label><span class="label-icon">‚è±Ô∏è</span> Minutos por Partido</label>
                                    <input type="number" [(ngModel)]="torneo.tiempo_por_partido" placeholder="20">
                                </div>
                            </div>

                            <div class="points-config-header">
                                <span class="icon">‚≠ê</span>
                                <span>Puntos para el Ranking (APP)</span>
                            </div>

                            <div class="form-grid points-grid">
                                <div class="form-group points-item">
                                    <label>ü•á 1¬∞ Lugar</label>
                                    <input type="number" [(ngModel)]="torneo.puntos_1er_lugar">
                                </div>
                                <div class="form-group points-item">
                                    <label>ü•à 2¬∞ Lugar</label>
                                    <input type="number" [(ngModel)]="torneo.puntos_2do_lugar">
                                </div>
                                <div class="form-group points-item">
                                    <label>ü•â 3¬∞ Lugar</label>
                                    <input type="number" [(ngModel)]="torneo.puntos_3er_lugar">
                                </div>
                                <div class="form-group points-item">
                                    <label>üéüÔ∏è Participaci√≥n</label>
                                    <input type="number" [(ngModel)]="torneo.puntos_participacion">
                                </div>
                            </div>

                            <div class="actions-row-centered">
                                <button class="btn-create-premium" (click)="crearTorneo()">
                                    üöÄ Crear y Publicar Torneo
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- VISTA: LISTA DE TORNEOS -->
                <!-- VISTA: LISTA DE TORNEOS (ACTIVOS) -->
                <div class="view-container" *ngIf="activeTab === 'list'">

                    <!-- TORNEOS ACTIVOS MENU (Horizontal) -->
                    <div class="main-tabs-nav scroll-x">
                        <ng-container *ngFor="let t of torneos">
                            <button *ngIf="t.estado === 'Abierto'" class="tab-btn big-tab"
                                [class.active]="selectedTorneo?.id === t.id" (click)="selectTorneo(t)">
                                <div class="btn-content">
                                    <div class="frc" style="justify-content: space-between; width: 100%;">
                                        <span class="btn-title">{{ t.nombre }}</span>
                                        <span class="badge" [style.background]="'#dcfce7'" [style.color]="'#166534'"
                                            style="font-size: 9px; padding: 2px 6px; border-radius: 10px;">
                                            Abierto
                                        </span>
                                    </div>
                                    <span class="btn-subtitle">
                                        {{ t.fecha | date:'dd/MM' }} | {{ t.hora_inicio }}
                                    </span>
                                </div>
                            </button>
                        </ng-container>
                        <div *ngIf="!hasActiveTournaments()" class="empty-state">No hay torneos activos.</div>
                    </div>

                    <!-- DETALLE (Full Width Below) -->
                    <ng-container *ngTemplateOutlet="tournamentDetail"></ng-container>
                </div>

                <!-- VISTA: HISTORIAL (CERRADOS) -->
                <div class="view-container" *ngIf="activeTab === 'history'">
                    <div class="main-tabs-nav scroll-x">
                        <ng-container *ngFor="let t of torneos">
                            <button *ngIf="t.estado !== 'Abierto'" class="tab-btn big-tab"
                                [class.active]="selectedTorneo?.id === t.id" (click)="selectTorneo(t)">
                                <div class="btn-content">
                                    <div class="frc" style="justify-content: space-between; width: 100%;">
                                        <span class="btn-title">{{ t.nombre }}</span>
                                        <span class="badge" [style.background]="'#fee2e2'" [style.color]="'#991b1b'"
                                            style="font-size: 9px; padding: 2px 6px; border-radius: 10px;">
                                            Cerrado
                                        </span>
                                    </div>
                                    <span class="btn-subtitle">
                                        {{ t.fecha | date:'dd/MM' }} | {{ t.hora_inicio }}
                                    </span>
                                </div>
                            </button>
                        </ng-container>
                        <div *ngIf="!hasHistoryTournaments()" class="empty-state">No hay torneos en el historial.
                        </div>
                    </div>

                    <!-- DETALLE (Full Width Below) -->
                    <ng-container *ngTemplateOutlet="tournamentDetail"></ng-container>
                </div>

                <!-- TEMPLATE REUTILIZABLE PARA EL DETALLE -->
                <ng-template #tournamentDetail>
                    <div class="detail-column full-width" *ngIf="selectedTorneo">
                        <!-- SUB-TABS (ON TOP like main tabs) -->
                        <div class="main-tabs-nav">
                            <button class="tab-btn" [class.active]="activeDetailTab === 'inscription'"
                                (click)="activeDetailTab = 'inscription'">
                                <span class="icon">üìù</span> Inscripci√≥n
                            </button>
                            <button class="tab-btn" [class.active]="activeDetailTab === 'fixture'"
                                (click)="activeDetailTab = 'fixture'">
                                <span class="icon">üìÖ</span> Fixture
                            </button>
                            <button class="tab-btn" [class.active]="activeDetailTab === 'ranking'"
                                (click)="activeDetailTab = 'ranking'">
                                <span class="icon">üìä</span> Posiciones
                            </button>
                        </div>

                        <div class="card glass-card detail-card">
                            <div class="card-header">
                                <div class="header-info">
                                    <h2>{{ selectedTorneo.nombre }}</h2>
                                    <div class="header-badges">
                                        <span class="badge" [class.badge-open]="!isCerrado"
                                            [class.badge-closed]="isCerrado">
                                            {{ isCerrado ? 'Cerrado' : 'Abierto' }}
                                        </span>
                                    </div>
                                </div>
                                <div class="header-actions" *ngIf="!isCerrado" style="display: flex; gap: 10px;">
                                    <button class="btn-cancel-edit" (click)="cancelarTorneo(selectedTorneo.id)"
                                        style="background: #fee2e2; color: #991b1b; border: 1px solid #fecaca;">
                                        üóëÔ∏è Cancelar Torneo
                                    </button>
                                    <button class="btn-close-torneo" (click)="cerrarTorneo(selectedTorneo.id)">
                                        üèÅ Cerrar Americano
                                    </button>
                                </div>
                            </div>

                            <!-- TAB: INSCRIPCION -->
                            <div class="tab-content" *ngIf="activeDetailTab === 'inscription'">
                                <div class="management-section" *ngIf="!isCerrado">
                                    <h3>Inscripci√≥n de Parejas</h3>

                                    <!-- B√∫squeda y Armado de Pareja -->
                                    <div class="pair-builder-container">
                                        <div class="search-section">
                                            <input type="text" [(ngModel)]="searchTerm" (input)="searchPlayers()"
                                                placeholder="Buscar jugador...">
                                            <div class="search-results" *ngIf="filteredUsers.length > 0">
                                                <div *ngFor="let u of filteredUsers" class="search-item"
                                                    (click)="selectPlayerForPair(u)">
                                                    <span>{{ u.nombre }}</span>
                                                    <small>{{ u.usuario }}</small>
                                                </div>
                                            </div>
                                            <div class="manual-add-option"
                                                *ngIf="searchTerm.length > 2 && filteredUsers.length === 0">
                                                <div class="search-item manual" (click)="addManualPlayer(searchTerm)">
                                                    <span>‚ûï Agregar "{{ searchTerm }}" como invitado</span>
                                                    <small style="color: #ff9800;">‚ö†Ô∏è No suma puntos</small>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="slots-container">
                                            <div class="pair-slot" [class.filled]="pairingSlot1">
                                                <span class="slot-label">J1</span>
                                                <span class="slot-value">{{ pairingSlot1 ? pairingSlot1.nombre : '...'
                                                    }}</span>
                                                <button class="remove-btn" *ngIf="pairingSlot1"
                                                    (click)="removePlayerFromPair(1)">√ó</button>
                                            </div>
                                            <div class="vs-mini">&</div>
                                            <div class="pair-slot" [class.filled]="pairingSlot2">
                                                <span class="slot-label">J2</span>
                                                <span class="slot-value">{{ pairingSlot2 ? pairingSlot2.nombre : '...'
                                                    }}</span>
                                                <button class="remove-btn" *ngIf="pairingSlot2"
                                                    (click)="removePlayerFromPair(2)">√ó</button>
                                            </div>
                                            <button class="btn-add-pair" [disabled]="!pairingSlot1 || !pairingSlot2"
                                                (click)="addPair()">
                                                {{ editingParticipanteId ? 'Actualizar' : 'Inscribir' }}
                                            </button>
                                            <button class="btn-cancel-edit" *ngIf="editingParticipanteId"
                                                (click)="cancelEdit()">
                                                Cancelar
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Listado de Inscritos -->
                                <div class="management-section" style="margin-top: 2rem;">
                                    <h3>Parejas Inscritas ({{ participantes.length }})</h3>
                                    <div class="registered-list">
                                        <div *ngFor="let p of participantes; let i = index" class="registered-item">
                                            <div class="couple-info">
                                                <span class="badge-number">P{{ i + 1 }}</span>
                                                <span class="team-names">{{ p.jugador1_nombre }} / {{ p.jugador2_nombre
                                                    }}</span>
                                            </div>
                                            <div class="item-actions" *ngIf="!isCerrado">
                                                <button class="btn-edit-small" (click)="editPair(p)" title="Editar">
                                                    ‚úèÔ∏è
                                                </button>
                                                <button class="btn-delete-small" (click)="removePair(p.id)"
                                                    title="Eliminar">
                                                    üóëÔ∏è
                                                </button>
                                            </div>
                                        </div>
                                        <div *ngIf="participantes.length === 0" class="empty-msg">No hay parejas
                                            inscritas.</div>
                                    </div>
                                </div>
                            </div>

                            <!-- TAB: FIXTURE -->
                            <div class="tab-content" *ngIf="activeDetailTab === 'fixture'">
                                <div class="management-section">
                                    <div class="section-header-row frc"
                                        style="justify-content: space-between; margin-bottom: 30px;">
                                        <div class="frc gap-10">
                                            <span class="icon" style="font-size: 24px;">üìÖ</span>
                                            <h3 style="margin: 0; border: none; padding: 0;">Fixture del Torneo</h3>
                                        </div>
                                        <div class="actions frc gap-10" *ngIf="!isCerrado">
                                            <button *ngIf="matches.length === 0" class="btn-create-premium"
                                                style="padding: 10px 20px; font-size: 13px;"
                                                [disabled]="participantes.length < 2"
                                                (click)="generarPartidos(selectedTorneo.id)">
                                                ‚ö° Generar Fixture
                                            </button>

                                            <button *ngIf="isGrupos && matches.length > 0 && !hasPhase('Semifinales')"
                                                class="btn-primary small" (click)="closeGroupsAndGeneratePlayoffs()">
                                                üèÜ Generar Semifinales
                                            </button>

                                            <button *ngIf="isGrupos && hasPhase('Semifinales') && !hasPhase('Finales')"
                                                class="btn-primary small"
                                                style="background: #eab308; border-color: #ca8a04;"
                                                (click)="generateFinals()">
                                                üèÅ Generar Finales
                                            </button>

                                            <button *ngIf="matches.length > 0" class="btn-cancel-edit"
                                                style="padding: 8px 15px; font-size: 11px;"
                                                (click)="generarPartidos(selectedTorneo.id)">
                                                üîÑ Reiniciar Todo
                                            </button>
                                        </div>
                                    </div>

                                    <div class="fixture-content animate-in" *ngIf="matches.length > 0">

                                        <!-- Phase Tabs -->
                                        <div class="round-mini-tabs"
                                            style="background: #f1f5f9; padding: 4px; border-radius: 14px; margin-bottom: 30px;"
                                            *ngIf="matchesGrouped.length > 1">
                                            <button *ngFor="let fase of matchesGrouped" class="rm-btn"
                                                [class.active]="activeFaseTab === fase.name"
                                                (click)="activeFaseTab = fase.name">
                                                {{ fase.name }}
                                            </button>
                                        </div>

                                        <!-- Active Phase Content -->
                                        <div *ngFor="let fase of matchesGrouped">
                                            <div class="fase-container" *ngIf="activeFaseTab === fase.name">

                                                <div class="groups-layout"
                                                    [class.split-view]="fase.name === 'Grupos' && fase.groups.length === 2">
                                                    <div *ngFor="let grupo of fase.groups" class="group-column">
                                                        <div class="fase-header"
                                                            style="margin-top: 20px; border-bottom: none;">
                                                            <div class="fase-icon">
                                                                {{ grupo.name === 'Oro' ? 'ü•á' : (grupo.name === 'Plata'
                                                                ?
                                                                'ü•à' : 'üìä') }}
                                                            </div>
                                                            <h3 class="fase-title">
                                                                {{ grupo.name === 'Oro' ? 'Copa de Oro' :
                                                                (grupo.name === 'Plata' ? 'Copa de Plata' :
                                                                (grupo.name === 'General' ? 'Tabla √önica' : 'Grupo ' +
                                                                grupo.name)) }}
                                                            </h3>
                                                        </div>

                                                        <!-- Round Selectors -->
                                                        <div class="round-mini-tabs" *ngIf="grupo.rounds.length > 1">
                                                            <button *ngFor="let round of grupo.rounds" class="rm-btn"
                                                                [class.active]="grupo.activeRound === round.number"
                                                                (click)="grupo.activeRound = round.number">
                                                                Ronda {{ round.number }}
                                                            </button>
                                                        </div>

                                                        <!-- Round Content -->
                                                        <div *ngFor="let round of grupo.rounds">
                                                            <div class="round-group animate-in"
                                                                *ngIf="grupo.activeRound === round.number || grupo.rounds.length === 1">
                                                                <!-- Don't show redundant header in split view if tabs exist, but keeping for now -->
                                                                <div class="round-header_premium"
                                                                    *ngIf="!(fase.name === 'Grupos' && fase.groups.length === 2)">
                                                                    <div class="rh-info">
                                                                        <span class="rh-dot"></span>
                                                                        <h4>Enfrentamientos - R{{ round.number }}</h4>
                                                                    </div>
                                                                    <button class="btn-save-round-glass frc gap-5"
                                                                        (click)="saveRound(round.number)"
                                                                        *ngIf="!isCerrado">
                                                                        <span>üíæ</span> Guardar Ronda
                                                                    </button>
                                                                </div>

                                                                <div class="match-list">
                                                                    <div *ngFor="let m of round.matches"
                                                                        class="match-card premium-card"
                                                                        [class.mini-card]="fase.name === 'Grupos'"
                                                                        [class.done]="m.finalizado">
                                                                        <div class="match-header">
                                                                            <div class="m-badge-row">
                                                                                <span class="phase-tag">{{ m.fase
                                                                                    }}</span>
                                                                                <span class="group-tag"
                                                                                    *ngIf="m.grupo_id && m.grupo_id !== 'General'">{{
                                                                                    m.grupo_id }}</span>
                                                                            </div>
                                                                            <div class="m-info">
                                                                                <span class="m-time">üïí {{ m.hora_inicio
                                                                                    |
                                                                                    slice:0:5 }}</span>
                                                                                <span class="m-court">üìç C{{
                                                                                    m.num_cancha ||
                                                                                    '?' }}</span>
                                                                            </div>
                                                                        </div>

                                                                        <div class="score-grid">
                                                                            <!-- Team 1 -->
                                                                            <div class="score-row">
                                                                                <div class="player-info">
                                                                                    <span class="pair-tag">{{
                                                                                        getCoupleLabel(m.jugador1_id,
                                                                                        m.jugador1_nombre) }}</span>
                                                                                    <div class="names-stack">
                                                                                        <span class="name">{{
                                                                                            m.jugador1_nombre }}</span>
                                                                                        <span class="name">{{
                                                                                            m.jugador2_nombre }}</span>
                                                                                    </div>
                                                                                </div>
                                                                                <input type="number" class="score-box"
                                                                                    [(ngModel)]="m.puntos_t1"
                                                                                    [disabled]="isCerrado">
                                                                            </div>

                                                                            <div class="score-divider">VS</div>

                                                                            <!-- Team 2 -->
                                                                            <div class="score-row">
                                                                                <div class="player-info right">
                                                                                    <span class="pair-tag">{{
                                                                                        getCoupleLabel(m.jugador3_id,
                                                                                        m.jugador3_nombre) }}</span>
                                                                                    <div class="names-stack">
                                                                                        <span class="name">{{
                                                                                            m.jugador3_nombre }}</span>
                                                                                        <span class="name">{{
                                                                                            m.jugador4_nombre }}</span>
                                                                                    </div>
                                                                                </div>
                                                                                <input type="number" class="score-box"
                                                                                    [(ngModel)]="m.puntos_t2"
                                                                                    [disabled]="isCerrado">
                                                                            </div>
                                                                        </div>

                                                                        <div class="match-actions-center"
                                                                            *ngIf="!isCerrado">
                                                                            <button class="btn-update-premium"
                                                                                (click)="saveScore(m, false)">
                                                                                {{ m.finalizado ? 'Modificar' :
                                                                                'Actualizar' }}
                                                                            </button>
                                                                        </div>
                                                                        <div class="match-status-badge frc gap-5"
                                                                            *ngIf="m.finalizado">
                                                                            <span>‚úÖ</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div *ngIf="matches.length === 0" class="empty-msg"
                                        style="padding: 60px; text-align: center;">
                                        <div style="font-size: 40px; margin-bottom: 20px;">üéæ</div>
                                        <p style="font-weight: 600; color: #1e293b;">
                                            {{ participantes.length < 2 ? 'Necesitas al menos 2 parejas para comenzar.'
                                                : 'El fixture est√° listo para ser generado.' }} </p>
                                    </div>
                                </div>
                            </div>

                            <!-- TAB: POSICIONES (RANKING) -->
                            <div class="tab-content animate-in" *ngIf="activeDetailTab === 'ranking'">
                                <div class="ranking-table-container premium-ranking">
                                    <!-- VISTA DE PODIO PARA AMERICANO MINI TORNEO (GRUPOS) -->
                                    <div *ngIf="isGrupos; else standardRanking" class="podium-view">
                                        <h3 class="podium-title">üèÜ Cuadro de Honor</h3>

                                        <div class="podium-grid">
                                            <!-- COPA DE ORO -->
                                            <div class="podium-card gold-card">
                                                <div class="card-badge gold">ü•á Copa de Oro</div>

                                                <div class="winner-row" *ngFor="let p of participantes"
                                                    [hidden]="p.final_rank !== 1">
                                                    <span class="crown">üëë CAMPEONES</span>
                                                    <div class="pair-names-big">{{ p.jugador1_nombre }} & {{
                                                        p.jugador2_nombre }}</div>
                                                </div>

                                                <div class="runner-row" *ngFor="let p of participantes"
                                                    [hidden]="p.final_rank !== 2">
                                                    <span class="sub-label">Subcampeones</span>
                                                    <div class="pair-names-small">{{ p.jugador1_nombre }} & {{
                                                        p.jugador2_nombre }}</div>
                                                </div>

                                                <div class="empty-state-mini" *ngIf="!hasRank(1) && !hasRank(2)">
                                                    Final de Oro pendiente...
                                                </div>
                                            </div>

                                            <!-- COPA DE PLATA -->
                                            <div class="podium-card silver-card">
                                                <div class="card-badge silver">ü•à Copa de Plata</div>

                                                <div class="winner-row" *ngFor="let p of participantes"
                                                    [hidden]="p.final_rank !== 3">
                                                    <span class="crown">üëë CAMPEONES</span>
                                                    <div class="pair-names-big">{{ p.jugador1_nombre }} & {{
                                                        p.jugador2_nombre }}</div>
                                                </div>

                                                <div class="runner-row" *ngFor="let p of participantes"
                                                    [hidden]="p.final_rank !== 4">
                                                    <span class="sub-label">Subcampeones</span>
                                                    <div class="pair-names-small">{{ p.jugador1_nombre }} & {{
                                                        p.jugador2_nombre }}</div>
                                                </div>

                                                <div class="empty-state-mini" *ngIf="!hasRank(3) && !hasRank(4)">
                                                    Final de Plata pendiente...
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- TABLA EST√ÅNDAR PARA OTROS TORNEOS -->
                                    <ng-template #standardRanking>
                                        <table class="ranking-table">
                                            <thead>
                                                <tr>
                                                    <th style="width: 60px;">Pos</th>
                                                    <th>Pareja</th>
                                                    <th class="txt-center" title="Partidos Jugados">PJ</th>
                                                    <th class="txt-center" title="Partidos Ganados">PG</th>
                                                    <th class="txt-center" title="Juegos a Favor">JF</th>
                                                    <th class="txt-center" title="Juegos en Contra">JC</th>
                                                    <th class="txt-center" title="Diferencia de Games">Dif</th>
                                                    <th class="txt-center" style="color: #2563eb;">Total Puntos</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr *ngFor="let p of participantes; let i = index">
                                                    <td class="rank-pos">
                                                        <div class="pos-badge" [class.gold]="i===0"
                                                            [class.silver]="i===1" [class.bronze]="i===2">
                                                            {{ i < 3 ? '' : i + 1 }} <span *ngIf="i===0">ü•á</span>
                                                                <span *ngIf="i===1">ü•à</span>
                                                                <span *ngIf="i===2">ü•â</span>
                                                        </div>
                                                    </td>
                                                    <td>
                                                        <div class="team-players-stack">
                                                            <span class="p-main">{{ p.jugador1_nombre }}</span>
                                                            <span class="p-main">{{ p.jugador2_nombre }}</span>
                                                        </div>
                                                    </td>
                                                    <td class="txt-center font-bold">{{ p.partidos_jugados || 0 }}</td>
                                                    <td class="txt-center font-bold" style="color: #16a34a;">{{
                                                        p.partidos_ganados || 0 }}</td>
                                                    <td class="txt-center">{{ p.games_ganados || 0 }}</td>
                                                    <td class="txt-center">{{ p.games_perdidos || 0 }}</td>
                                                    <td class="txt-center font-bold"
                                                        [style.color]="(p.diferencia_games > 0) ? '#16a34a' : ((p.diferencia_games < 0) ? '#dc2626' : '#64748b')">
                                                        {{ p.diferencia_games > 0 ? '+' : ''}}{{ p.diferencia_games || 0
                                                        }}
                                                    </td>
                                                    <td class="txt-center total-pts">
                                                        <span class="pts-pill">{{ p.puntos_totales }}</span>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                        <div *ngIf="participantes.length === 0" class="empty-table">No hay registros
                                            a√∫n.</div>
                                    </ng-template>
                                </div>
                            </div>
                        </div>
                    </div>
                </ng-template>
            </div>
        </div>
    </main>
</div>