<div class="admin-layout">
    <app-sidebar [userId]="userId" [jugadorNombre]="userName" [jugadorFoto]="userFoto" [role]="userRole"
        activePage="torneos">
    </app-sidebar>

    <main class="main-content">
        <header class="content-header">
            <div class="header-title">
                <h1>Gesti√≥n de Torneos <span class="badge">PRO</span></h1>
                <p>Configuraci√≥n de Fase de Grupos y Cuadros Eliminatorios</p>
            </div>
            <div class="header-actions">
                <button class="btn-primary" (click)="activeTab = 'create'; selectedTorneo = null">
                    <span class="icon">‚ûï</span> Nuevo Torneo
                </button>
            </div>
        </header>

        <!-- TABS PRINCIPALES (S√ìLO SI NO HAY TORNEO SELECCIONADO PARA EVITAR SOLAPE) -->
        <div class="tabs-nav" *ngIf="!selectedTorneo"
            style="display: flex; gap: 5px; background: #f1f5f9; padding: 5px; border-radius: 12px; margin-bottom: 25px; width: fit-content;">
            <button [class.active]="activeTab === 'list'" (click)="activeTab = 'list'"
                style="padding: 10px 20px; border-radius: 10px; border: none; font-weight: 800; cursor: pointer; transition: all 0.2s;"
                [style.background]="activeTab === 'list' ? '#fff' : 'transparent'"
                [style.boxShadow]="activeTab === 'list' ? '0 4px 6px rgba(0,0,0,0.05)' : 'none'"
                [style.color]="activeTab === 'list' ? '#0f172a' : '#64748b'">Mis Torneos</button>
            <button [class.active]="activeTab === 'create'" (click)="activeTab = 'create'"
                style="padding: 10px 20px; border-radius: 10px; border: none; font-weight: 800; cursor: pointer; transition: all 0.2s;"
                [style.background]="activeTab === 'create' ? '#fff' : 'transparent'"
                [style.boxShadow]="activeTab === 'create' ? '0 4px 6px rgba(0,0,0,0.05)' : 'none'"
                [style.color]="activeTab === 'create' ? '#0f172a' : '#64748b'">Configurar Nuevo</button>
        </div>

        <!-- LISTADO DE TORNEOS -->
        <section class="torneos-list" *ngIf="activeTab === 'list' && !selectedTorneo">
            <div class="torneo-card" *ngFor="let t of torneos" (click)="selectTorneo(t)">
                <div class="card-status" [attr.data-status]="t.estado">{{ t.estado }}</div>
                <div class="card-info">
                    <h3>{{ t.nombre }}</h3>
                    <p><span class="icon">üìÖ</span> {{ t.fecha_inicio | date:'dd MMM, yyyy' }}</p>
                    <p><span class="icon">üèÜ</span> {{ t.tipo }}</p>
                </div>
                <div class="card-action">
                    <button class="btn-outline">Gestionar</button>
                </div>
            </div>

            <div class="empty-state" *ngIf="torneos.length === 0">
                <div class="empty-icon">üéæ</div>
                <p>No tienes torneos activos. ¬°Crea el primero!</p>
            </div>
        </section>

        <!-- CREACI√ìN DE TORNEO -->
        <section class="create-form-container" *ngIf="activeTab === 'create'">
            <div class="form-card">
                <h2>Detalles del Torneo</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Nombre del Torneo</label>
                        <input type="text" [(ngModel)]="newTorneo.nombre" placeholder="Ej: Open Verano Padel Center">
                    </div>
                    <div class="form-group">
                        <label>Club Anfitri√≥n</label>
                        <select [(ngModel)]="newTorneo.club_id">
                            <option *ngFor="let c of clubes" [value]="c.id">{{ c.nombre }}</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Fecha de Inicio</label>
                        <input type="date" [(ngModel)]="newTorneo.fecha_inicio">
                    </div>
                    <div class="form-group">
                        <label>Tipo de Formato</label>
                        <select [(ngModel)]="newTorneo.tipo">
                            <option value="Grupos + Playoffs">Grupos + Playoffs</option>
                            <option value="Eliminaci√≥n Directa">Eliminaci√≥n Directa</option>
                        </select>
                    </div>
                </div>

                <!-- CATEGORIAS A REPARTIR -->
                <div class="categories-setup" style="margin-top: 30px;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h3
                            style="font-size: 14px; font-weight: 800; color: #888; text-transform: uppercase; margin: 0;">
                            Categor√≠as y Puntos</h3>
                        <button class="btn-outline" (click)="cargarCategoriasStandard()"
                            style="font-size: 11px; padding: 5px 10px;">Cargar Est√°ndar (CL)</button>
                    </div>
                    <div class="cat-setup-grid" style="display: grid; gap: 10px; margin-top: 15px;">
                        <div class="cat-setup-row" *ngFor="let cat of newTorneo.categorias; let i = index"
                            style="display: grid; grid-template-columns: 2fr 1fr 1fr 50px; gap: 10px; align-items: end;">
                            <div class="form-group">
                                <label *ngIf="i === 0">Nombre Categor√≠a</label>
                                <input type="text" [(ngModel)]="cat.nombre" placeholder="Ej: 5ta">
                            </div>
                            <div class="form-group">
                                <label *ngIf="i === 0">Parejas M√°x</label>
                                <input type="number" [(ngModel)]="cat.max_parejas">
                            </div>
                            <div class="form-group">
                                <label *ngIf="i === 0">Puntos Repartir</label>
                                <input type="number" [(ngModel)]="cat.puntos_repartir">
                            </div>
                            <button class="btn-mini danger" (click)="newTorneo.categorias.splice(i, 1)"
                                style="margin-bottom: 5px;">X</button>
                        </div>
                    </div>
                    <button class="btn-outline"
                        (click)="newTorneo.categorias.push({nombre:'', max_parejas:16, puntos_repartir:0})"
                        style="margin-top: 15px; font-size: 11px;">+ A√±adir Otra Categor√≠a</button>
                </div>

                <div class="form-group full-width" style="margin-top: 20px;">
                    <label>Descripci√≥n / Reglas</label>
                    <textarea [(ngModel)]="newTorneo.descripcion" rows="3"></textarea>
                </div>
                <div class="form-footer" style="margin-top: 30px;">
                    <button class="btn-primary" (click)="crearTorneo()">Crear Torneo Principal</button>
                </div>
            </div>
        </section>

        <!-- GESTI√ìN DE TORNEO SELECCIONADO -->
        <section class="torneo-details" *ngIf="selectedTorneo">
            <div class="details-header" style="display: flex; align-items: center; gap: 20px; margin-bottom: 30px;">
                <button class="btn-outline" (click)="selectedTorneo = null" style="padding: 8px 15px;">‚Üê</button>
                <h2 style="margin: 0; font-weight: 900; text-transform: uppercase; letter-spacing: -1px;">{{
                    selectedTorneo.nombre }}</h2>
            </div>

            <div class="tournament-detail-tabs"
                style="display: flex; gap: 5px; background: #fff; padding: 4px; border-bottom: 1px solid #e2e8f0; margin-bottom: 30px; overflow-x: auto; -webkit-overflow-scrolling: touch;">

                <button (click)="activeDetailTab = 'resumen'; calculateStats()"
                    [class.active]="activeDetailTab === 'resumen'"
                    style="padding: 14px 24px; border: none; background: none; font-weight: 800; color: #64748b; cursor: pointer; transition: all 0.2s; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; position: relative; display: flex; align-items: center; gap: 8px;"
                    [style.color]="activeDetailTab === 'resumen' ? '#0f172a' : '#64748b'">
                    <span>üìä</span> Resumen
                    <div *ngIf="activeDetailTab === 'resumen'"
                        style="position: absolute; bottom: -1px; left: 0; right: 0; height: 3px; background: #000; border-radius: 4px;">
                    </div>
                </button>

                <button (click)="activeDetailTab = 'config'" [class.active]="activeDetailTab === 'config'"
                    style="padding: 14px 24px; border: none; background: none; font-weight: 800; color: #64748b; cursor: pointer; transition: all 0.2s; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; position: relative; display: flex; align-items: center; gap: 8px;"
                    [style.color]="activeDetailTab === 'config' ? '#0f172a' : '#64748b'">
                    <span>üë•</span> Inscritos / Categor√≠as
                    <div *ngIf="activeDetailTab === 'config'"
                        style="position: absolute; bottom: -1px; left: 0; right: 0; height: 3px; background: #000; border-radius: 4px;">
                    </div>
                </button>

                <button (click)="activeDetailTab = 'programacion'; initAvailabilityGrid()"
                    [class.active]="activeDetailTab === 'programacion'"
                    style="padding: 14px 24px; border: none; background: none; font-weight: 800; color: #64748b; cursor: pointer; transition: all 0.2s; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; position: relative; display: flex; align-items: center; gap: 8px;"
                    [style.color]="activeDetailTab === 'programacion' ? '#0f172a' : '#64748b'">
                    <span>üïí</span> Horarios
                    <div *ngIf="activeDetailTab === 'programacion'"
                        style="position: absolute; bottom: -1px; left: 0; right: 0; height: 3px; background: #000; border-radius: 4px;">
                    </div>
                </button>

                <button (click)="activeDetailTab = 'generar'" [class.active]="activeDetailTab === 'generar'"
                    style="padding: 14px 24px; border: none; background: none; font-weight: 800; color: #64748b; cursor: pointer; transition: all 0.2s; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; position: relative; display: flex; align-items: center; gap: 8px;"
                    [style.color]="activeDetailTab === 'generar' ? '#0f172a' : '#64748b'">
                    <span>‚ö°</span> Fase de Grupos
                    <div *ngIf="activeDetailTab === 'generar'"
                        style="position: absolute; bottom: -1px; left: 0; right: 0; height: 3px; background: #000; border-radius: 4px;">
                    </div>
                </button>

                <button (click)="activeDetailTab = 'playoffs'" [class.active]="activeDetailTab === 'playoffs'"
                    style="padding: 14px 24px; border: none; background: none; font-weight: 800; color: #64748b; cursor: pointer; transition: all 0.2s; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; position: relative; display: flex; align-items: center; gap: 8px;"
                    [style.color]="activeDetailTab === 'playoffs' ? '#0f172a' : '#64748b'">
                    <span>üèÜ</span> Cuadro Final
                    <div *ngIf="activeDetailTab === 'playoffs'"
                        style="position: absolute; bottom: -1px; left: 0; right: 0; height: 3px; background: #000; border-radius: 4px;">
                    </div>
                </button>
            </div>

            <div class="details-content">

                <!-- TAB: CONFIGURACI√ìN HORAS -->
                <div *ngIf="activeDetailTab === 'programacion'">
                    <div class="card-config">
                        <div class="card-config" style="padding: 0;">

                            <!-- Header & Controls -->
                            <div
                                style="background: #f8fafc; padding: 20px; border-bottom: 1px solid #e2e8f0; border-radius: 12px 12px 0 0;">
                                <div
                                    style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: flex-end; gap: 20px;">
                                    <div>
                                        <h3 style="margin: 0 0 5px; font-size: 18px; color: #0f172a;">Disponibilidad de
                                            Horarios</h3>
                                        <p style="margin: 0; font-size: 13px; color: #64748b;">
                                            Define el rango de fechas y los horarios de juego para el torneo.
                                        </p>
                                    </div>

                                    <div
                                        style="display: flex; gap: 15px; align-items: flex-end; background: #fff; padding: 10px 15px; border-radius: 10px; border: 1px solid #cbd5e1; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                                        <div>
                                            <label
                                                style="display: block; font-size: 11px; font-weight: 700; color: #64748b; margin-bottom: 4px; text-transform: uppercase;">Inicio</label>
                                            <input type="date" [(ngModel)]="planParams.startDate"
                                                (change)="initAvailabilityGrid()"
                                                style="padding: 6px 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; font-family: inherit; color: #334155; outline: none; background: #f8fafc;">
                                        </div>
                                        <div style="color: #94a3b8; padding-bottom: 8px;">‚ûú</div>
                                        <div>
                                            <label
                                                style="display: block; font-size: 11px; font-weight: 700; color: #64748b; margin-bottom: 4px; text-transform: uppercase;">Fin</label>
                                            <input type="date" [(ngModel)]="planParams.endDate"
                                                (change)="initAvailabilityGrid()"
                                                style="padding: 6px 10px; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 13px; font-family: inherit; color: #334155; outline: none; background: #f8fafc;">
                                        </div>
                                        <button (click)="saveTorneoFechas()" title="Guardar Fechas"
                                            style="background: #3b82f6; color: white; border: none; width: 32px; height: 32px; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: background 0.2s;">
                                            üíæ
                                        </button>
                                    </div>
                                </div>

                                <div *ngIf="gridDays.length > 0"
                                    style="margin-top: 20px; display: flex; align-items: center; gap: 20px; font-size: 13px;">
                                    <div style="display: flex; align-items: center; gap: 6px;">
                                        <span
                                            style="width: 12px; height: 12px; background: #dcfce7; border: 1px solid #16a34a; border-radius: 3px;"></span>
                                        <span style="color: #334155;">Horario Disponible</span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 6px;">
                                        <span
                                            style="width: 12px; height: 12px; background: #f1f5f9; border: 1px solid #cbd5e1; border-radius: 3px;"></span>
                                        <span style="color: #64748b;">No Disponible</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Empty State -->
                            <div *ngIf="gridDays.length === 0"
                                style="padding: 40px; text-align: center; color: #94a3b8;">
                                <div style="font-size: 40px; margin-bottom: 10px;">üìÖ</div>
                                <p style="margin: 0; font-weight: 500;">Selecciona una fecha de inicio y fin para
                                    configurar la grilla.</p>
                            </div>

                            <!-- Grid -->
                            <div *ngIf="gridDays.length > 0" class="schedule-grid-container"
                                style="overflow-x: auto; padding-bottom: 10px;" (mouseleave)="onMouseUp()">
                                <table
                                    style="width: 100%; border-collapse: separate; border-spacing: 0; font-size: 12px; user-select: none;">
                                    <thead>
                                        <tr>
                                            <th
                                                style="padding: 12px 15px; text-align: left; background: #fff; border-bottom: 2px solid #e2e8f0; border-right: 1px solid #e2e8f0; min-width: 80px; position: sticky; left: 0; z-index: 20; color: #475569; font-weight: 800;">
                                                HORA
                                            </th>
                                            <th *ngFor="let day of gridDays"
                                                style="padding: 10px; text-align: center; background: #f8fafc; border-bottom: 2px solid #e2e8f0; min-width: 100px; color: #475569; font-weight: 600;">
                                                {{ day | date:'EEE d/MM' : 'UTC' }}
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr *ngFor="let hour of gridHours">
                                            <!-- Row Header: Hour -->
                                            <td
                                                style="padding: 8px 15px; font-weight: 700; color: #64748b; border-bottom: 1px solid #f1f5f9; background: #fff; position: sticky; left: 0; z-index: 10; border-right: 1px solid #e2e8f0;">
                                                {{ hour }}:00
                                            </td>

                                            <!-- Cells: Days -->
                                            <td *ngFor="let day of gridDays" (mousedown)="onMouseDown(day, hour)"
                                                (mouseenter)="onMouseEnter(day, hour)" (mouseup)="onMouseUp()"
                                                [style.background]="isHourEnabled(day, hour) ? '#dcfce7' : '#ffffff'"
                                                style="border-bottom: 1px solid #f1f5f9; border-right: 1px solid #f8fafc; cursor: pointer; text-align: center; transition: background 0.05s; height: 36px; padding: 0;">
                                                <div *ngIf="isHourEnabled(day, hour)"
                                                    style="display: flex; align-items: center; justify-content: center; height: 100%; width: 100%; color: #15803d; font-weight: bold;">
                                                    ‚úì
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- TAB: RESUMEN -->
                <div *ngIf="activeDetailTab === 'resumen'">
                    <div class="stats-dashboard"
                        style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">

                        <div class="stat-card"
                            style="background: #fff; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 2px 4px rgba(0,0,0,0.02);">
                            <div
                                style="font-size: 11px; text-transform: uppercase; color: #64748b; font-weight: 700; margin-bottom: 5px;">
                                Total Inscritos</div>
                            <div style="font-size: 28px; font-weight: 900; color: #0f172a;">{{
                                tournamentStats.totalInscritos }} <span
                                    style="font-size: 14px; font-weight: 500; color: #94a3b8;">parejas</span></div>
                        </div>

                        <div class="stat-card"
                            style="background: #fff; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 2px 4px rgba(0,0,0,0.02);">
                            <div
                                style="font-size: 11px; text-transform: uppercase; color: #64748b; font-weight: 700; margin-bottom: 5px;">
                                Partidos Estimados</div>
                            <div style="font-size: 28px; font-weight: 900; color: #3b82f6;">~{{
                                tournamentStats.totalPartidosEstimados }}</div>
                        </div>

                        <div class="stat-card"
                            style="background: #fff; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 2px 4px rgba(0,0,0,0.02);">
                            <div
                                style="font-size: 11px; text-transform: uppercase; color: #64748b; font-weight: 700; margin-bottom: 5px;">
                                Horas Necesarias</div>
                            <div style="font-size: 28px; font-weight: 900; color: #f59e0b;">{{
                                tournamentStats.horasNecesarias | number:'1.0-1' }}h</div>
                        </div>

                        <div class="stat-card"
                            style="background: #fff; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 2px 4px rgba(0,0,0,0.02);">
                            <div
                                style="font-size: 11px; text-transform: uppercase; color: #64748b; font-weight: 700; margin-bottom: 5px;">
                                Horas Disponibles</div>
                            <div style="font-size: 28px; font-weight: 900;"
                                [style.color]="tournamentStats.horasDisponibles >= tournamentStats.horasNecesarias ? '#16a34a' : '#ef4444'">
                                {{ tournamentStats.horasDisponibles }}h
                            </div>
                            <div *ngIf="tournamentStats.horasDisponibles < tournamentStats.horasNecesarias"
                                style="font-size: 11px; color: #ef4444; font-weight: 700;">
                                ‚ö†Ô∏è Faltan {{ (tournamentStats.horasNecesarias - tournamentStats.horasDisponibles) |
                                number:'1.0-1' }}h
                            </div>
                        </div>
                    </div>

                    <h4 style="margin-bottom: 15px; text-transform: uppercase; font-size: 13px; color: #64748b;">
                        Detalle
                        por Categor√≠a</h4>
                    <table
                        style="width: 100%; border-collapse: collapse; font-size: 13px; background: #fff; border-radius: 10px; overflow: hidden; border: 1px solid #e2e8f0;">
                        <thead>
                            <tr style="background: #f8fafc; text-align: left;">
                                <th style="padding: 12px 20px; font-weight: 700; color: #475569;">Categor√≠a</th>
                                <th style="padding: 12px 20px; font-weight: 700; color: #475569;">Inscritos</th>
                                <th style="padding: 12px 20px; font-weight: 700; color: #475569;">Partidos (Est.)
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let c of tournamentStats.categorias" style="border-bottom: 1px solid #f1f5f9;">
                                <td style="padding: 12px 20px; font-weight: 600;">{{ c.nombre }}</td>
                                <td style="padding: 12px 20px;">{{ c.inscritos }}</td>
                                <td style="padding: 12px 20px;">{{ c.partidos }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- TAB: FASE DE GRUPOS -->
                <div *ngIf="activeDetailTab === 'generar'">
                    <!-- COMPACT CONTROL BAR -->
                    <div
                        style="background: #fff; border-radius: 12px; border: 1px solid #e2e8f0; padding: 15px; margin-bottom: 20px; display: flex; flex-wrap: wrap; align-items: center; justify-content: space-between; gap: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.02);">

                        <!-- SIMULATION MODE (MASSIVE) -->
                        <div
                            style="display: flex; align-items: center; gap: 15px; border-right: 1px solid #f1f5f9; padding-right: 20px;">
                            <div style="font-size: 20px;">üß™</div>
                            <div>
                                <h3
                                    style="margin: 0; font-size: 11px; font-weight: 900; text-transform: uppercase; color: #64748b;">
                                    Simulador Masivo</h3>
                                <button (click)="generateSchedule()"
                                    style="background: #0f172a; color: #fff; border: none; padding: 6px 15px; border-radius: 6px; font-weight: 900; font-size: 10px; cursor: pointer; transition: all 0.2s; text-transform: uppercase; margin-top: 5px;">
                                    SIMULAR TORNEO COMPLETO ‚ö°
                                </button>
                            </div>
                        </div>

                        <!-- REAL MODE (IF GROUPS CREATED) -->
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div style="font-size: 20px;">üèÜ</div>
                            <div>
                                <h3
                                    style="margin: 0; font-size: 11px; font-weight: 900; text-transform: uppercase; color: #16a34a;">
                                    Programaci√≥n Real</h3>
                                <button (click)="autoSchedule()"
                                    style="background: #16a34a; color: #fff; border: none; padding: 6px 15px; border-radius: 6px; font-weight: 900; font-size: 10px; cursor: pointer; transition: all 0.2s; text-transform: uppercase; margin-top: 5px;">
                                    AUTO-PROGRAMAR REAL üìÜ
                                </button>
                            </div>
                        </div>

                        <!-- CONFIG MINS -->
                        <div
                            style="display: flex; align-items: center; gap: 15px; margin-left: auto; background: #f8fafc; padding: 8px 15px; border-radius: 8px;">
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <label
                                    style="font-size: 10px; font-weight: 700; color: #64748b; text-transform: uppercase;">Mins/Part:</label>
                                <input type="number" [(ngModel)]="matchDuration" min="15" step="15"
                                    style="width: 50px; padding: 4px 6px; border: 1px solid #cbd5e1; border-radius: 4px; font-weight: 800; font-size: 11px; outline: none;">
                            </div>
                        </div>
                    </div>

                    <!-- RESULTADO DEL CALENDARIO -->
                    <div class="calendar-schedule" *ngIf="calendarDays.length > 0">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding: 0 10px;">
                            <h4
                                style="margin: 0; font-weight: 900; text-transform: uppercase; font-size: 12px; color: #64748b; letter-spacing: 2px;">
                                üìÖ Cronograma Calculado
                            </h4>
                            <button *ngIf="!hasFictionalMatches()" (click)="savePlanificacion()"
                                style="background: #10b981; color: #fff; border: none; padding: 8px 15px; border-radius: 8px; font-weight: 900; font-size: 10px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 5px;">
                                üíæ GUARDAR PLANIFICACI√ìN REAL
                            </button>
                        </div>

                        <!-- Day Tabs (smaller and wrapped) -->
                        <div class="day-tabs"
                            style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 25px; justify-content: center;">
                            <button *ngFor="let day of calendarDays; let i = index" (click)="selectedDayIndex = i"
                                [style.background]="selectedDayIndex === i ? '#0f172a' : '#fff'"
                                [style.color]="selectedDayIndex === i ? '#fff' : '#64748b'"
                                [style.border]="selectedDayIndex === i ? '1px solid #0f172a' : '1px solid #e2e8f0'"
                                style="padding: 6px 12px; border-radius: 12px; font-size: 11px; font-weight: 800; cursor: pointer; white-space: nowrap; transition: all 0.2s; min-width: 80px;">
                                <span *ngIf="day.date !== 'Sin Programar'">{{ day.date | date:'EEE d' | uppercase
                                    }}</span>
                                <span *ngIf="day.date === 'Sin Programar'">PENDIENTE</span>
                            </button>
                        </div>

                        <!-- Selected Day Content -->
                        <div class="day-content" *ngIf="calendarDays[selectedDayIndex]"
                            style="background: #fff; border: 1px solid #e2e8f0; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.02);">
                            <h4
                                style="margin: 0 0 20px; font-size: 16px; font-weight: 900; text-transform: uppercase; color: #0f172a; text-align: center; border-bottom: 2px solid #f8fafc; padding-bottom: 12px; letter-spacing: 1px;">
                                {{ calendarDays[selectedDayIndex].date === 'Sin Programar' ? 'Partidos Pendientes de
                                Cupo' : (calendarDays[selectedDayIndex].date | date:'EEEE d MMMM yyyy') }}
                            </h4>

                            <div class="matches-grid"
                                style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px;">
                                <div class="match-card" *ngFor="let m of calendarDays[selectedDayIndex].matches"
                                    style="padding: 15px; background: #fff; border-radius: 15px; border: 1px solid #f1f5f9; box-shadow: 0 4px 10px rgba(0,0,0,0.02); position: relative; transition: all 0.3s; display: flex; flex-direction: column; justify-content: space-between;">

                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                        <div
                                            style="display: flex; align-items: center; gap: 5px; font-weight: 800; color: #2563eb; background: #eff6ff; padding: 3px 10px; border-radius: 8px; font-size: 11px;">
                                            <span>‚è∞</span> {{ m.tempTime }}
                                        </div>
                                        <div
                                            style="font-size: 10px; font-weight: 700; color: #64748b; background: #f8fafc; padding: 3px 8px; border-radius: 8px;">
                                            üèüÔ∏è {{ m.court || 'Pendiente' }}
                                        </div>
                                    </div>

                                    <div style="margin-bottom: 12px; text-align: center;">
                                        <div
                                            style="font-weight: 700; color: #1e293b; font-size: 13px; line-height: 1.2;">
                                            {{ m.pareja1_nombre }}
                                        </div>
                                        <div
                                            style="font-size: 9px; color: #cbd5e1; font-weight: 900; margin: 4px 0; text-transform: uppercase;">
                                            v/s</div>
                                        <div
                                            style="font-weight: 700; color: #1e293b; font-size: 13px; line-height: 1.2;">
                                            {{ m.pareja2_nombre }}
                                        </div>
                                    </div>

                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; padding-top: 10px; border-top: 1px solid #f8fafc; margin-top: 5px;">
                                        <div style="display: flex; flex-direction: column; gap: 2px;">
                                            <span
                                                style="font-size: 9px; font-weight: 800; color: #94a3b8; text-transform: uppercase; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                                {{ m.category }} ‚Ä¢ {{ m.round }}
                                            </span>
                                            <span *ngIf="m.team1?.dummy || m.team2?.dummy"
                                                style="font-size: 8px; font-weight: 900; color: #f59e0b; text-transform: uppercase;">‚ö†Ô∏è
                                                Ficticio</span>
                                        </div>
                                        <div style="display: flex; align-items: center; gap: 8px;">
                                            <span *ngIf="m.resultado"
                                                style="font-size: 11px; font-weight: 900; color: #166534; background: #dcfce7; padding: 2px 8px; border-radius: 6px;">{{
                                                m.resultado }}</span>
                                            <button (click)="cargarResultado(m)"
                                                style="border: none; background: #f8fafc; color: #2563eb; font-size: 9px; font-weight: 900; cursor: pointer; padding: 4px 10px; border-radius: 6px; transition: all 0.2s;">
                                                {{ m.resultado ? 'EDIT' : 'SCORE' }}
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div *ngIf="activeDetailTab === 'config'">
                    <div class="categorias-grid"
                        style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; margin-bottom: 30px;">
                        <div class="categoria-item" *ngFor="let cat of categorias"
                            [class.selected]="selectedCategoria?.id === cat.id" (click)="selectCategoria(cat)"
                            style="padding: 22px; border-radius: 16px; border: 2px solid #e2e8f0; cursor: pointer; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; background: #fff;"
                            [style.borderColor]="selectedCategoria?.id === cat.id ? '#0f172a' : '#f1f5f9'"
                            [style.boxShadow]="selectedCategoria?.id === cat.id ? '0 10px 25px -5px rgba(0,0,0,0.1)' : 'none'"
                            [style.transform]="selectedCategoria?.id === cat.id ? 'translateY(-4px)' : 'none'">

                            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                <h4 style="margin: 0; font-weight: 900; font-size: 20px; color: #0f172a;">{{ cat.nombre
                                    }}</h4>
                                <div *ngIf="selectedCategoria?.id === cat.id"
                                    style="background: #0f172a; color: #fff; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px;">
                                    ‚úì</div>
                            </div>

                            <p
                                style="font-size: 11px; color: #64748b; font-weight: 800; margin: 8px 0 0; text-transform: uppercase; letter-spacing: 0.5px;">
                                {{ cat.max_parejas }} PAREJAS M√ÅX.</p>

                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px;">
                                <div class="pts-badge"
                                    style="font-size: 10px; color: #fff; background: #2563eb; padding: 4px 10px; border-radius: 6px; font-weight: 900;">
                                    {{ cat.puntos_repartir }} PTS
                                </div>
                                <span
                                    style="font-size: 10px; font-weight: 800; color: #94a3b8; text-transform: uppercase;">Inscripciones</span>
                            </div>
                        </div>

                        <button class="btn-add-cat"
                            style="border: 2px dashed #cbd5e1; background: #f8fafc; border-radius: 16px; color: #94a3b8; font-weight: 800; font-size: 11px; text-transform: uppercase; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; min-height: 120px; transition: all 0.2s;">
                            <span style="font-size: 20px;">+</span>
                            NUEVA CATEGOR√çA
                        </button>
                    </div>

                    <!-- INSCRIPCIONES DE LA CATEGORIA SELECCIONADA -->
                    <div class="inscripciones-section" *ngIf="selectedCategoria"
                        style="background: #fff; border-radius: 24px; padding: 30px; border: 1px solid #e2e8f0; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.02);">

                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                            <div>
                                <h3
                                    style="margin: 0; font-weight: 900; text-transform: uppercase; font-size: 15px; letter-spacing: 1px; color: #0f172a;">
                                    Parejas Inscritas en <span style="color: #2563eb;">{{ selectedCategoria.nombre
                                        }}</span>
                                </h3>
                                <div style="font-size: 12px; color: #64748b; font-weight: 700; margin-top: 5px;">
                                    {{ inscripciones.length }} parejas de un m√°ximo de {{ selectedCategoria.max_parejas
                                    }}
                                </div>
                            </div>
                            <button class="btn-primary"
                                style="font-size: 11px; padding: 10px 20px; border-radius: 10px; background: #0f172a; color: #fff; border: none; font-weight: 800; cursor: pointer;">
                                + A√ëADIR PAREJA MANUAL
                            </button>
                        </div>

                        <div class="inscripciones-list"
                            style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 12px;">
                            <div class="ins-card" *ngFor="let ins of inscripciones"
                                style="background: #f8fafc; padding: 18px; border-radius: 16px; display: flex; justify-content: space-between; align-items: center; border: 1px solid transparent; transition: all 0.2s;">
                                <div>
                                    <div
                                        style="font-weight: 800; color: #0f172a; font-size: 15px; display: flex; align-items: center; gap: 10px;">
                                        <span>üéæ</span>
                                        {{ ins.nombre_jugador_1 }} / {{ ins.nombre_jugador_2 }}
                                    </div>
                                    <div
                                        style="font-size: 11px; color: #64748b; font-weight: 700; margin-top: 6px; display: flex; gap: 15px;">
                                        <span>ID: #{{ ins.id }}</span>
                                        <span>üìÖ {{ ins.fecha_inscripcion | date:'dd/MM/yyyy' }}</span>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <div [style.background]="ins.validado ? '#dcfce7' : '#fee2e2'"
                                        [style.color]="ins.validado ? '#166534' : '#991b1b'"
                                        style="padding: 6px 12px; border-radius: 8px; font-size: 10px; font-weight: 900; text-transform: uppercase; letter-spacing: 0.5px;">
                                        {{ ins.validado ? '‚úì Validada' : '‚è≥ Pendiente' }}
                                    </div>
                                    <button class="btn-mini-danger" (click)="eliminarPareja(ins.id)"
                                        style="background: transparent; border: none; font-size: 18px; cursor: pointer; padding: 5px; filter: grayscale(1); opacity: 0.5; transition: all 0.2s;">üóëÔ∏è</button>
                                </div>
                            </div>

                            <div *ngIf="inscripciones.length === 0"
                                style="padding: 60px 40px; text-align: center; color: #94a3b8; border: 2px dashed #e2e8f0; border-radius: 20px; grid-column: 1 / -1;">
                                <div style="font-size: 40px; margin-bottom: 15px; opacity: 0.3;">üìã</div>
                                <h4
                                    style="margin: 0; font-weight: 900; color: #64748b; text-transform: uppercase; font-size: 13px;">
                                    Sin inscripciones</h4>
                                <p style="margin: 8px 0 0; font-weight: 700; font-size: 12px;">Comienza a a√±adir parejas
                                    manualmente o espera las inscripciones online.</p>
                            </div>
                        </div>
                    </div>
                </div>



                <!-- SECCI√ìN DE GRUPOS ELIMINADA (CONSOLIDADA EN FASE DE GRUPOS) -->


                <!-- PLAYOFFS -->
                <div *ngIf="activeDetailTab === 'playoffs'">
                    <div class="playoff-bracket">
                        <div class="empty-state" *ngIf="playoffMatches.length === 0"
                            style="padding: 80px; text-align: center;">
                            <p style="color: #888; font-weight: 500;">Todav√≠a no se ha generado el Cuadro Final
                                (Octavos, Cuartos, Semi, Final).</p>
                            <button class="btn-primary" (click)="activeDetailTab = 'generar'"
                                style="margin-top: 20px;">IR A FASE DE GRUPOS</button>
                        </div>

                        <div class="bracket-container" *ngIf="playoffMatches.length > 0"
                            style="display: flex; gap: 40px; overflow-x: auto; padding-bottom: 20px;">

                            <!-- OCTAVOS -->
                            <div class="round-column" *ngIf="playoffRounds.octavos.length > 0"
                                style="display: flex; flex-direction: column; justify-content: space-around; min-width: 260px;">
                                <h3
                                    style="text-align: center; text-transform: uppercase; font-size: 14px; color: #888; margin-bottom: 20px;">
                                    Octavos de Final</h3>
                                <div class="match-card-bracket" *ngFor="let m of playoffRounds.octavos"
                                    style="background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; border-left: 4px solid #3b82f6; position: relative;">
                                    <div class="teams" style="display: flex; flex-direction: column; gap: 8px;">
                                        <div class="team"
                                            [style.font-weight]="m.ganador_id == m.pareja1_id ? '900' : '500'"
                                            style="font-size: 13px; display: flex; justify-content: space-between;">
                                            <span>{{ m.pareja1_nombre }}</span>
                                            <span *ngIf="m.resultado" style="font-weight: 900; color: #3b82f6;">{{
                                                m.resultado }}</span>
                                        </div>
                                        <div class="team"
                                            [style.font-weight]="m.ganador_id == m.pareja2_id ? '900' : '500'"
                                            style="font-size: 13px; display: flex; justify-content: space-between;">
                                            <span>{{ m.pareja2_nombre }}</span>
                                        </div>
                                    </div>
                                    <button class="btn-mini-edit" (click)="cargarResultado(m)"
                                        *ngIf="m.estado !== 'Finalizado'"
                                        style="position: absolute; top: 5px; right: 5px; font-size: 10px; padding: 2px 6px; background: #eee; border: none; border-radius: 4px; cursor: pointer;">‚úèÔ∏è</button>
                                </div>
                            </div>

                            <!-- CUARTOS -->
                            <div class="round-column" *ngIf="playoffRounds.cuartos.length > 0"
                                style="display: flex; flex-direction: column; justify-content: space-around; min-width: 260px;">
                                <h3
                                    style="text-align: center; text-transform: uppercase; font-size: 14px; color: #888; margin-bottom: 20px;">
                                    Cuartos de Final</h3>
                                <div class="match-card-bracket" *ngFor="let m of playoffRounds.cuartos"
                                    style="background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; border-left: 4px solid #8b5cf6; position: relative;">
                                    <div class="teams" style="display: flex; flex-direction: column; gap: 8px;">
                                        <div class="team"
                                            [style.font-weight]="m.ganador_id == m.pareja1_id ? '900' : '500'"
                                            style="font-size: 13px; display: flex; justify-content: space-between;">
                                            <span>{{ m.pareja1_nombre }}</span>
                                            <span *ngIf="m.resultado" style="font-weight: 900; color: #8b5cf6;">{{
                                                m.resultado }}</span>
                                        </div>
                                        <div class="team"
                                            [style.font-weight]="m.ganador_id == m.pareja2_id ? '900' : '500'"
                                            style="font-size: 13px; display: flex; justify-content: space-between;">
                                            <span>{{ m.pareja2_nombre }}</span>
                                        </div>
                                    </div>
                                    <button class="btn-mini-edit" (click)="cargarResultado(m)"
                                        *ngIf="m.estado !== 'Finalizado'"
                                        style="position: absolute; top: 5px; right: 5px; font-size: 10px; padding: 2px 6px; background: #eee; border: none; border-radius: 4px; cursor: pointer;">‚úèÔ∏è</button>
                                </div>
                            </div>

                            <!-- SEMIFINAL -->
                            <div class="round-column" *ngIf="playoffRounds.semi.length > 0"
                                style="display: flex; flex-direction: column; justify-content: space-around; min-width: 260px;">
                                <h3
                                    style="text-align: center; text-transform: uppercase; font-size: 14px; color: #888; margin-bottom: 20px;">
                                    Semifinal</h3>
                                <div class="match-card-bracket" *ngFor="let m of playoffRounds.semi"
                                    style="background: #fff; padding: 15px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); margin-bottom: 20px; border-left: 4px solid #ef4444; position: relative;">
                                    <div class="teams" style="display: flex; flex-direction: column; gap: 8px;">
                                        <div class="team"
                                            [style.font-weight]="m.ganador_id == m.pareja1_id ? '900' : '500'"
                                            style="font-size: 13px; display: flex; justify-content: space-between;">
                                            <span>{{ m.pareja1_nombre }}</span>
                                            <span *ngIf="m.resultado" style="font-weight: 900; color: #ef4444;">{{
                                                m.resultado }}</span>
                                        </div>
                                        <div class="team"
                                            [style.font-weight]="m.ganador_id == m.pareja2_id ? '900' : '500'"
                                            style="font-size: 13px; display: flex; justify-content: space-between;">
                                            <span>{{ m.pareja2_nombre }}</span>
                                        </div>
                                    </div>
                                    <button class="btn-mini-edit" (click)="cargarResultado(m)"
                                        *ngIf="m.estado !== 'Finalizado'"
                                        style="position: absolute; top: 5px; right: 5px; font-size: 10px; padding: 2px 6px; background: #eee; border: none; border-radius: 4px; cursor: pointer;">‚úèÔ∏è</button>
                                </div>
                            </div>

                            <!-- FINAL -->
                            <div class="round-column" *ngIf="playoffRounds.final.length > 0"
                                style="display: flex; flex-direction: column; justify-content: center; min-width: 260px;">
                                <h3
                                    style="text-align: center; text-transform: uppercase; font-size: 18px; font-weight: 900; color: #fbbf24; margin-bottom: 20px;">
                                    üèÜ GRAN FINAL üèÜ</h3>
                                <div class="match-card-bracket" *ngFor="let m of playoffRounds.final"
                                    style="background: #fff; padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(251, 191, 36, 0.2); margin-bottom: 20px; border: 2px solid #fbbf24; position: relative; text-align: center;">
                                    <div class="teams" style="display: flex; flex-direction: column; gap: 15px;">
                                        <div class="team"
                                            [style.font-weight]="m.ganador_id == m.pareja1_id ? '900' : '500'"
                                            style="font-size: 16px;">
                                            {{ m.pareja1_nombre }}
                                        </div>
                                        <div style="font-size: 12px; color: #ccc;">VS</div>
                                        <div class="team"
                                            [style.font-weight]="m.ganador_id == m.pareja2_id ? '900' : '500'"
                                            style="font-size: 16px;">
                                            {{ m.pareja2_nombre }}
                                        </div>
                                        <div *ngIf="m.resultado"
                                            style="margin-top: 10px; font-weight: 900; color: #fbbf24; font-size: 14px;">
                                            {{ m.resultado }}</div>
                                    </div>
                                    <button class="btn-mini-edit" (click)="cargarResultado(m)"
                                        *ngIf="m.estado !== 'Finalizado'"
                                        style="position: absolute; top: 10px; right: 10px; font-size: 12px; padding: 4px 8px; background: #fef3c7; border: none; border-radius: 6px; cursor: pointer; color: #d97706;">Cargar
                                        Resultado</button>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- PLANIFICACI√ìN -->
                <!-- Removed separate tab, now integrated in Calendario -->
            </div>

        </section>
    </main>
    <!-- SCOREBOARD MODAL -->
    <div class="scoreboard-overlay" *ngIf="showScoreModal && currentMatchForScore">
        <div class="scoreboard-modal">
            <div class="scoreboard-header">
                <h3>Resultado del Partido</h3>
                <p>{{ currentMatchForScore.ronda || 'Fase de Grupos' }}</p>
                <button class="close-modal-btn" (click)="closeScoreModal()"
                    style="position: absolute; top: 10px; right: 10px; border: none; background: transparent; font-size: 20px; cursor: pointer;">&times;</button>
            </div>

            <div class="score-grid">
                <div class="header-row">
                    <span>Pareja</span>
                    <span>Set 1</span>
                    <span>Set 2</span>
                    <span>Set 3</span>
                </div>

                <div class="player-row">
                    <div class="player-name">{{ currentMatchForScore.pareja1_nombre }}</div>
                    <input type="number" [(ngModel)]="scoreInput.s1p1" placeholder="-">
                    <input type="number" [(ngModel)]="scoreInput.s2p1" placeholder="-">
                    <input type="number" [(ngModel)]="scoreInput.s3p1" placeholder="-">
                </div>

                <div class="player-row">
                    <div class="player-name">{{ currentMatchForScore.pareja2_nombre }}</div>
                    <input type="number" [(ngModel)]="scoreInput.s1p2" placeholder="-">
                    <input type="number" [(ngModel)]="scoreInput.s2p2" placeholder="-">
                    <input type="number" [(ngModel)]="scoreInput.s3p2" placeholder="-">
                </div>
            </div>

            <div class="score-actions">
                <button class="btn-cancel" (click)="closeScoreModal()">Cancelar</button>
                <button class="btn-save" (click)="saveScore()">Guardar Marcador</button>
            </div>
        </div>
    </div>
</div>